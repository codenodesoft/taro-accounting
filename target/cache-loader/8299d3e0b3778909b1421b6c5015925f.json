{"remainingRequest":"C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\thread-loader\\dist\\cjs.js??ref--9-2!C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\ts-loader\\index.js??ref--9-3!C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\angular-router-loader\\src\\index.js!C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\tslint-loader\\index.js!C:\\Users\\hp\\Documents\\soptorshi-jhipster\\src\\main\\webapp\\app\\entities\\commercial-budget-extended\\commercial-budget-update-extended.component.ts","dependencies":[{"path":"C:\\Users\\hp\\Documents\\soptorshi-jhipster\\src\\main\\webapp\\app\\entities\\commercial-budget-extended\\commercial-budget-update-extended.component.ts","mtime":1625565386661},{"path":"C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\angular2-template-loader\\index.js","mtime":1486570058000},{"path":"C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\ts-loader\\index.js","mtime":1545640398000},{"path":"C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\angular-router-loader\\src\\index.js","mtime":1512749902000},{"path":"C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\tslint-loader\\index.js","mtime":1519899048000}],"contextDependencies":[],"result":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tslib_1 = require(\"tslib\");\r\nvar core_1 = require(\"@angular/core\");\r\nvar router_1 = require(\"@angular/router\");\r\nvar commercial_budget_extended_service_1 = require(\"./commercial-budget-extended.service\");\r\nvar commercial_budget_1 = require(\"app/entities/commercial-budget\");\r\nvar shared_1 = require(\"app/shared\");\r\nvar commercial_budget_model_1 = require(\"app/shared/model/commercial-budget.model\");\r\nvar moment = require(\"moment\");\r\nvar commercial_product_info_extended_1 = require(\"app/entities/commercial-product-info-extended\");\r\nvar commercial_pi_extended_1 = require(\"app/entities/commercial-pi-extended\");\r\nvar core_2 = require(\"app/core\");\r\nvar CommercialBudgetUpdateExtendedComponent = /** @class */ (function (_super) {\r\n    tslib_1.__extends(CommercialBudgetUpdateExtendedComponent, _super);\r\n    function CommercialBudgetUpdateExtendedComponent(commercialBudgetService, activatedRoute, commercialProductInfoService, commercialPiService, router, accountService) {\r\n        var _this = _super.call(this, commercialBudgetService, activatedRoute) || this;\r\n        _this.commercialBudgetService = commercialBudgetService;\r\n        _this.activatedRoute = activatedRoute;\r\n        _this.commercialProductInfoService = commercialProductInfoService;\r\n        _this.commercialPiService = commercialPiService;\r\n        _this.router = router;\r\n        _this.accountService = accountService;\r\n        _this.approved = false;\r\n        _this.rejected = false;\r\n        _this.saveAsDraft = false;\r\n        _this.waitingForApproval = false;\r\n        _this.showSaveAsDraftBtn = false;\r\n        _this.showWaitingForApprovalBtn = false;\r\n        _this.showApproveBtn = false;\r\n        _this.showRejectBtn = false;\r\n        _this.isAdmin = false;\r\n        _this.commercialProductInfos = [];\r\n        return _this;\r\n    }\r\n    CommercialBudgetUpdateExtendedComponent.prototype.ngOnInit = function () {\r\n        var _this = this;\r\n        this.isSaving = false;\r\n        this.activatedRoute.data.subscribe(function (_a) {\r\n            var commercialBudget = _a.commercialBudget;\r\n            _this.commercialBudget = commercialBudget;\r\n            if (!_this.commercialBudget.id) {\r\n                _this.commercialBudget.budgetStatus = commercial_budget_model_1.CommercialBudgetStatus.SAVE_AS_DRAFT;\r\n            }\r\n            _this.createdOn = _this.commercialBudget.createdOn != null ? _this.commercialBudget.createdOn.format(shared_1.DATE_TIME_FORMAT) : null;\r\n            _this.updatedOn = _this.commercialBudget.updatedOn != null ? _this.commercialBudget.updatedOn.format(shared_1.DATE_TIME_FORMAT) : null;\r\n        });\r\n        this.generateNewBudgetNumber();\r\n        this.generateNewPiNumber();\r\n        this.getProductInfo();\r\n        this.isAdmin = this.accountService.hasAnyAuthority(['ROLE_ADMIN', 'ROLE_COMMERCIAL_ADMIN']);\r\n    };\r\n    CommercialBudgetUpdateExtendedComponent.prototype.generateNewBudgetNumber = function () {\r\n        var _this = this;\r\n        if (!this.commercialBudget.id) {\r\n            this.commercialBudgetService\r\n                .query()\r\n                .subscribe(function (res) { return _this.assignBudgetNumber(res.body, res.headers); }, function (res) { return 'Error'; });\r\n        }\r\n    };\r\n    CommercialBudgetUpdateExtendedComponent.prototype.assignBudgetNumber = function (data, headers) {\r\n        var today = new Date();\r\n        var year = today.getFullYear();\r\n        var month = today.getMonth() + 1;\r\n        var maxId = data.length + 1;\r\n        this.commercialBudget.budgetNo = 'B-' + year + '-' + ('0' + month).slice(-2) + '-' + this.zeroPadding(maxId, 4);\r\n    };\r\n    CommercialBudgetUpdateExtendedComponent.prototype.generateNewPiNumber = function () {\r\n        var _this = this;\r\n        if (!this.commercialBudget.id) {\r\n            this.commercialPiService\r\n                .query()\r\n                .subscribe(function (res) { return _this.assignPiNumber(res.body, res.headers); }, function (res) { return 'Error'; });\r\n        }\r\n    };\r\n    CommercialBudgetUpdateExtendedComponent.prototype.assignPiNumber = function (data, headers) {\r\n        var today = new Date();\r\n        var year = today.getFullYear();\r\n        var month = today.getMonth() + 1;\r\n        var maxId = data.length + 1;\r\n        this.commercialBudget.proformaNo = 'SOFPL-' + year + '-' + ('0' + month).slice(-2) + '-PI-' + this.zeroPadding(maxId, 4);\r\n    };\r\n    CommercialBudgetUpdateExtendedComponent.prototype.zeroPadding = function (num, places) {\r\n        var zero = places - num.toString().length + 1;\r\n        return Array(+(zero > 0 && zero)).join('0') + num;\r\n    };\r\n    CommercialBudgetUpdateExtendedComponent.prototype.calculateTotalTransportationCost = function () {\r\n        var seaPortPrice = this.commercialBudget.seaPortCost === undefined || null ? 0 : this.commercialBudget.seaPortCost;\r\n        var airPortPrice = this.commercialBudget.airPortCost === undefined || null ? 0 : this.commercialBudget.airPortCost;\r\n        var landPortPrice = this.commercialBudget.landPortCost === undefined || null ? 0 : this.commercialBudget.landPortCost;\r\n        var insurancePrice = this.commercialBudget.insurancePrice === undefined || null ? 0 : this.commercialBudget.insurancePrice;\r\n        this.commercialBudget.totalTransportationCost = seaPortPrice + airPortPrice + landPortPrice + insurancePrice;\r\n    };\r\n    CommercialBudgetUpdateExtendedComponent.prototype.save = function () {\r\n        this.isSaving = true;\r\n        if (this.saveAsDraft) {\r\n            this.commercialBudget.budgetStatus = commercial_budget_model_1.CommercialBudgetStatus.SAVE_AS_DRAFT;\r\n        }\r\n        else if (this.waitingForApproval) {\r\n            this.commercialBudget.budgetStatus = commercial_budget_model_1.CommercialBudgetStatus.WAITING_FOR_APPROVAL;\r\n        }\r\n        else if (this.approved) {\r\n            this.commercialBudget.budgetStatus = commercial_budget_model_1.CommercialBudgetStatus.APPROVED;\r\n        }\r\n        else if (this.rejected) {\r\n            this.commercialBudget.budgetStatus = commercial_budget_model_1.CommercialBudgetStatus.REJECTED;\r\n        }\r\n        this.commercialBudget.createdOn = this.createdOn != null ? moment(this.createdOn, shared_1.DATE_TIME_FORMAT) : null;\r\n        this.commercialBudget.updatedOn = this.updatedOn != null ? moment(this.updatedOn, shared_1.DATE_TIME_FORMAT) : null;\r\n        if (this.commercialBudget.id !== undefined) {\r\n            this.subscribeToSaveResponse(this.commercialBudgetService.update(this.commercialBudget));\r\n        }\r\n        else {\r\n            this.subscribeToSaveResponse(this.commercialBudgetService.create(this.commercialBudget));\r\n        }\r\n    };\r\n    CommercialBudgetUpdateExtendedComponent.prototype.onSaveSuccess = function () {\r\n        this.isSaving = true;\r\n        this.previousState();\r\n    };\r\n    CommercialBudgetUpdateExtendedComponent.prototype.getProductInfo = function () {\r\n        var _this = this;\r\n        this.commercialProductInfoService\r\n            .query({\r\n            'commercialBudgetId.equals': this.commercialBudget.id == undefined ? 0 : this.commercialBudget.id\r\n        })\r\n            .subscribe(function (res) { return _this.assignProductInfos(res.body, res.headers); }, function (res) { return 'error'; });\r\n    };\r\n    CommercialBudgetUpdateExtendedComponent.prototype.assignProductInfos = function (data, headers) {\r\n        this.commercialProductInfos = [];\r\n        for (var i = 0; i < data.length; i++) {\r\n            this.commercialProductInfos.push(data[i]);\r\n        }\r\n    };\r\n    CommercialBudgetUpdateExtendedComponent.prototype.updateCustomer = function () {\r\n        if (this.commercialBudget.type === 'LOCAL') {\r\n            this.commercialBudget.customer = commercial_budget_model_1.CommercialCustomerCategory.ZONE;\r\n        }\r\n        else if (this.commercialBudget.type === 'FOREIGN') {\r\n            this.commercialBudget.customer = commercial_budget_model_1.CommercialCustomerCategory.FOREIGN;\r\n        }\r\n    };\r\n    var _a, _b, _c, _d, _e, _f;\r\n    CommercialBudgetUpdateExtendedComponent = tslib_1.__decorate([\r\n        core_1.Component({\r\n            selector: 'jhi-commercial-budget-update-extended',\r\n            templateUrl: './commercial-budget-update-extended.component.html'\r\n        }),\r\n        tslib_1.__metadata(\"design:paramtypes\", [typeof (_a = typeof commercial_budget_extended_service_1.CommercialBudgetExtendedService !== \"undefined\" && commercial_budget_extended_service_1.CommercialBudgetExtendedService) === \"function\" ? _a : Object, typeof (_b = typeof router_1.ActivatedRoute !== \"undefined\" && router_1.ActivatedRoute) === \"function\" ? _b : Object, typeof (_c = typeof commercial_product_info_extended_1.CommercialProductInfoExtendedService !== \"undefined\" && commercial_product_info_extended_1.CommercialProductInfoExtendedService) === \"function\" ? _c : Object, typeof (_d = typeof commercial_pi_extended_1.CommercialPiExtendedService !== \"undefined\" && commercial_pi_extended_1.CommercialPiExtendedService) === \"function\" ? _d : Object, typeof (_e = typeof router_1.Router !== \"undefined\" && router_1.Router) === \"function\" ? _e : Object, typeof (_f = typeof core_2.AccountService !== \"undefined\" && core_2.AccountService) === \"function\" ? _f : Object])\r\n    ], CommercialBudgetUpdateExtendedComponent);\r\n    return CommercialBudgetUpdateExtendedComponent;\r\n}(commercial_budget_1.CommercialBudgetUpdateComponent));\r\nexports.CommercialBudgetUpdateExtendedComponent = CommercialBudgetUpdateExtendedComponent;\r\n",{"version":3,"file":"C:\\Users\\hp\\Documents\\soptorshi-jhipster\\src\\main\\webapp\\app\\entities\\commercial-budget-extended\\commercial-budget-update-extended.component.ts","sourceRoot":"","sources":["C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\angular-router-loader\\src\\index.js!C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\tslint-loader\\index.js!C:\\Users\\hp\\Documents\\soptorshi-jhipster\\src\\main\\webapp\\app\\entities\\commercial-budget-extended\\commercial-budget-update-extended.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { CommercialBudgetExtendedService } from './commercial-budget-extended.service';\r\nimport { CommercialBudgetUpdateComponent } from 'app/entities/commercial-budget';\r\nimport { HttpErrorResponse, HttpHeaders, HttpResponse } from '@angular/common/http';\r\nimport { ICommercialProductInfo } from 'app/shared/model/commercial-product-info.model';\r\nimport { DATE_TIME_FORMAT } from 'app/shared';\r\nimport { CommercialBudgetStatus, CommercialCustomerCategory, ICommercialBudget } from 'app/shared/model/commercial-budget.model';\r\nimport * as moment from 'moment';\r\nimport { CommercialProductInfoExtendedService } from 'app/entities/commercial-product-info-extended';\r\nimport { ICommercialPi } from 'app/shared/model/commercial-pi.model';\r\nimport { CommercialPiExtendedService } from 'app/entities/commercial-pi-extended';\r\nimport { AccountService } from 'app/core';\r\n\r\n@Component({\r\n    selector: 'jhi-commercial-budget-update-extended',\r\n    templateUrl: './commercial-budget-update-extended.component.html'\r\n})\r\nexport class CommercialBudgetUpdateExtendedComponent extends CommercialBudgetUpdateComponent implements OnInit {\r\n    commercialProductInfos: ICommercialProductInfo[];\r\n    approved: boolean = false;\r\n    rejected: boolean = false;\r\n    saveAsDraft: boolean = false;\r\n    waitingForApproval: boolean = false;\r\n\r\n    showSaveAsDraftBtn: boolean = false;\r\n    showWaitingForApprovalBtn: boolean = false;\r\n    showApproveBtn: boolean = false;\r\n    showRejectBtn: boolean = false;\r\n\r\n    isAdmin: boolean = false;\r\n\r\n    constructor(\r\n        protected commercialBudgetService: CommercialBudgetExtendedService,\r\n        protected activatedRoute: ActivatedRoute,\r\n        protected commercialProductInfoService: CommercialProductInfoExtendedService,\r\n        protected commercialPiService: CommercialPiExtendedService,\r\n        protected router: Router,\r\n        protected accountService: AccountService\r\n    ) {\r\n        super(commercialBudgetService, activatedRoute);\r\n        this.commercialProductInfos = [];\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.isSaving = false;\r\n        this.activatedRoute.data.subscribe(({ commercialBudget }) => {\r\n            this.commercialBudget = commercialBudget;\r\n            if (!this.commercialBudget.id) {\r\n                this.commercialBudget.budgetStatus = CommercialBudgetStatus.SAVE_AS_DRAFT;\r\n            }\r\n            this.createdOn = this.commercialBudget.createdOn != null ? this.commercialBudget.createdOn.format(DATE_TIME_FORMAT) : null;\r\n            this.updatedOn = this.commercialBudget.updatedOn != null ? this.commercialBudget.updatedOn.format(DATE_TIME_FORMAT) : null;\r\n        });\r\n        this.generateNewBudgetNumber();\r\n        this.generateNewPiNumber();\r\n        this.getProductInfo();\r\n\r\n        this.isAdmin = this.accountService.hasAnyAuthority(['ROLE_ADMIN', 'ROLE_COMMERCIAL_ADMIN']);\r\n    }\r\n\r\n    generateNewBudgetNumber() {\r\n        if (!this.commercialBudget.id) {\r\n            this.commercialBudgetService\r\n                .query()\r\n                .subscribe(\r\n                    (res: HttpResponse<ICommercialBudget[]>) => this.assignBudgetNumber(res.body, res.headers),\r\n                    (res: HttpErrorResponse) => 'Error'\r\n                );\r\n        }\r\n    }\r\n\r\n    assignBudgetNumber(data: ICommercialBudget[], headers: HttpHeaders) {\r\n        let today = new Date();\r\n        let year = today.getFullYear();\r\n        let month = today.getMonth() + 1;\r\n        let maxId = data.length + 1;\r\n        this.commercialBudget.budgetNo = 'B-' + year + '-' + ('0' + month).slice(-2) + '-' + this.zeroPadding(maxId, 4);\r\n    }\r\n\r\n    generateNewPiNumber() {\r\n        if (!this.commercialBudget.id) {\r\n            this.commercialPiService\r\n                .query()\r\n                .subscribe(\r\n                    (res: HttpResponse<ICommercialPi[]>) => this.assignPiNumber(res.body, res.headers),\r\n                    (res: HttpErrorResponse) => 'Error'\r\n                );\r\n        }\r\n    }\r\n\r\n    assignPiNumber(data: ICommercialPi[], headers: HttpHeaders) {\r\n        let today = new Date();\r\n        let year = today.getFullYear();\r\n        let month = today.getMonth() + 1;\r\n        let maxId = data.length + 1;\r\n        this.commercialBudget.proformaNo = 'SOFPL-' + year + '-' + ('0' + month).slice(-2) + '-PI-' + this.zeroPadding(maxId, 4);\r\n    }\r\n\r\n    zeroPadding(num, places): string {\r\n        const zero = places - num.toString().length + 1;\r\n        return Array(+(zero > 0 && zero)).join('0') + num;\r\n    }\r\n\r\n    calculateTotalTransportationCost() {\r\n        let seaPortPrice: number = this.commercialBudget.seaPortCost === undefined || null ? 0 : this.commercialBudget.seaPortCost;\r\n        let airPortPrice: number = this.commercialBudget.airPortCost === undefined || null ? 0 : this.commercialBudget.airPortCost;\r\n        let landPortPrice: number = this.commercialBudget.landPortCost === undefined || null ? 0 : this.commercialBudget.landPortCost;\r\n        let insurancePrice: number = this.commercialBudget.insurancePrice === undefined || null ? 0 : this.commercialBudget.insurancePrice;\r\n\r\n        this.commercialBudget.totalTransportationCost = seaPortPrice + airPortPrice + landPortPrice + insurancePrice;\r\n    }\r\n\r\n    save() {\r\n        this.isSaving = true;\r\n        if (this.saveAsDraft) {\r\n            this.commercialBudget.budgetStatus = CommercialBudgetStatus.SAVE_AS_DRAFT;\r\n        } else if (this.waitingForApproval) {\r\n            this.commercialBudget.budgetStatus = CommercialBudgetStatus.WAITING_FOR_APPROVAL;\r\n        } else if (this.approved) {\r\n            this.commercialBudget.budgetStatus = CommercialBudgetStatus.APPROVED;\r\n        } else if (this.rejected) {\r\n            this.commercialBudget.budgetStatus = CommercialBudgetStatus.REJECTED;\r\n        }\r\n        this.commercialBudget.createdOn = this.createdOn != null ? moment(this.createdOn, DATE_TIME_FORMAT) : null;\r\n        this.commercialBudget.updatedOn = this.updatedOn != null ? moment(this.updatedOn, DATE_TIME_FORMAT) : null;\r\n        if (this.commercialBudget.id !== undefined) {\r\n            this.subscribeToSaveResponse(this.commercialBudgetService.update(this.commercialBudget));\r\n        } else {\r\n            this.subscribeToSaveResponse(this.commercialBudgetService.create(this.commercialBudget));\r\n        }\r\n    }\r\n\r\n    protected onSaveSuccess() {\r\n        this.isSaving = true;\r\n        this.previousState();\r\n    }\r\n\r\n    getProductInfo() {\r\n        this.commercialProductInfoService\r\n            .query({\r\n                'commercialBudgetId.equals': this.commercialBudget.id == undefined ? 0 : this.commercialBudget.id\r\n            })\r\n            .subscribe(\r\n                (res: HttpResponse<ICommercialProductInfo[]>) => this.assignProductInfos(res.body, res.headers),\r\n                (res: HttpErrorResponse) => 'error'\r\n            );\r\n    }\r\n\r\n    protected assignProductInfos(data: ICommercialProductInfo[], headers: HttpHeaders) {\r\n        this.commercialProductInfos = [];\r\n        for (let i = 0; i < data.length; i++) {\r\n            this.commercialProductInfos.push(data[i]);\r\n        }\r\n    }\r\n\r\n    updateCustomer() {\r\n        if (this.commercialBudget.type === 'LOCAL') {\r\n            this.commercialBudget.customer = CommercialCustomerCategory.ZONE;\r\n        } else if (this.commercialBudget.type === 'FOREIGN') {\r\n            this.commercialBudget.customer = CommercialCustomerCategory.FOREIGN;\r\n        }\r\n    }\r\n}\r\n"]}]}