{"remainingRequest":"C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\thread-loader\\dist\\cjs.js??ref--9-2!C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\ts-loader\\index.js??ref--9-3!C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\angular-router-loader\\src\\index.js!C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\tslint-loader\\index.js!C:\\Users\\hp\\Documents\\soptorshi-jhipster\\src\\main\\webapp\\app\\entities\\purchase-order-extended\\purchase-order-extended-update.component.ts","dependencies":[{"path":"C:\\Users\\hp\\Documents\\soptorshi-jhipster\\src\\main\\webapp\\app\\entities\\purchase-order-extended\\purchase-order-extended-update.component.ts","mtime":1625565387531},{"path":"C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\angular2-template-loader\\index.js","mtime":1486570058000},{"path":"C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\ts-loader\\index.js","mtime":1545640398000},{"path":"C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\angular-router-loader\\src\\index.js","mtime":1512749902000},{"path":"C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\tslint-loader\\index.js","mtime":1519899048000}],"contextDependencies":[],"result":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tslib_1 = require(\"tslib\");\r\nvar core_1 = require(\"@angular/core\");\r\nvar router_1 = require(\"@angular/router\");\r\nvar operators_1 = require(\"rxjs/operators\");\r\nvar moment = require(\"moment\");\r\nvar ng_jhipster_1 = require(\"ng-jhipster\");\r\nvar purchase_order_model_1 = require(\"app/shared/model/purchase-order.model\");\r\nvar requisition_1 = require(\"app/entities/requisition\");\r\nvar quotation_model_1 = require(\"app/shared/model/quotation.model\");\r\nvar quotation_1 = require(\"app/entities/quotation\");\r\nvar employee_1 = require(\"app/entities/employee\");\r\nvar core_2 = require(\"app/core\");\r\nvar purchase_order_1 = require(\"app/entities/purchase-order\");\r\nvar forms_1 = require(\"@angular/forms\");\r\nvar purchase_order_extended_service_1 = require(\"app/entities/purchase-order-extended/purchase-order-extended.service\");\r\nvar quotation_details_1 = require(\"app/entities/quotation-details\");\r\nvar rxjs_1 = require(\"rxjs\");\r\nvar PurchaseOrderExtendedUpdateComponent = /** @class */ (function (_super) {\r\n    tslib_1.__extends(PurchaseOrderExtendedUpdateComponent, _super);\r\n    function PurchaseOrderExtendedUpdateComponent(dataUtils, jhiAlertService, purchaseOrderService, requisitionService, quotationService, activatedRoute, employeeService, accountService, quotationDetailsService) {\r\n        var _this = _super.call(this, dataUtils, jhiAlertService, purchaseOrderService, requisitionService, quotationService, activatedRoute) || this;\r\n        _this.dataUtils = dataUtils;\r\n        _this.jhiAlertService = jhiAlertService;\r\n        _this.purchaseOrderService = purchaseOrderService;\r\n        _this.requisitionService = requisitionService;\r\n        _this.quotationService = quotationService;\r\n        _this.activatedRoute = activatedRoute;\r\n        _this.employeeService = employeeService;\r\n        _this.accountService = accountService;\r\n        _this.quotationDetailsService = quotationDetailsService;\r\n        return _this;\r\n    }\r\n    PurchaseOrderExtendedUpdateComponent.prototype.ngOnInit = function () {\r\n        var _this = this;\r\n        this.accountService.identity().then(function (account) {\r\n            _this.currentAccount = account;\r\n            console.log('Current account --->');\r\n            console.log(_this.currentAccount);\r\n            _this.employeeService\r\n                .query({\r\n                'employeeId.equals': _this.currentAccount.login\r\n            })\r\n                .subscribe(function (res) {\r\n                _this.currentEmployee = res.body[0];\r\n            }, function (res) { return _this.onError(res.message); });\r\n            _this.activatedRoute.data.subscribe(function (_a) {\r\n                var purchaseOrder = _a.purchaseOrder;\r\n                rxjs_1.of(purchaseOrder)\r\n                    .pipe(operators_1.switchMap(function (res) {\r\n                    _this.purchaseOrder = purchaseOrder;\r\n                    return rxjs_1.of(_this.purchaseOrder);\r\n                }))\r\n                    .pipe(operators_1.filter(function (res) {\r\n                    if (res.requisitionId)\r\n                        return true;\r\n                    else\r\n                        return false;\r\n                }))\r\n                    .subscribe(function () { return _this.fetchRequisitionAndQuotationWithDetails(); });\r\n                _this.disableOrEnableComponents();\r\n                _this.generatePurchaseOrderNo();\r\n            });\r\n        });\r\n        this.isSaving = false;\r\n        this.requisitionService\r\n            .query()\r\n            .pipe(operators_1.filter(function (mayBeOk) { return mayBeOk.ok; }), operators_1.map(function (response) { return response.body; }))\r\n            .subscribe(function (res) { return (_this.requisitions = res); }, function (res) { return _this.onError(res.message); });\r\n        this.quotationService\r\n            .query()\r\n            .pipe(operators_1.filter(function (mayBeOk) { return mayBeOk.ok; }), operators_1.map(function (response) { return response.body; }))\r\n            .subscribe(function (res) { return (_this.quotations = res); }, function (res) { return _this.onError(res.message); });\r\n    };\r\n    PurchaseOrderExtendedUpdateComponent.prototype.downloadReport = function () {\r\n        this.purchaseOrderService.downloadPurchaseOrderReport(this.purchaseOrder.id);\r\n    };\r\n    PurchaseOrderExtendedUpdateComponent.prototype.fetchRequisitionAndQuotationWithDetails = function () {\r\n        var _this = this;\r\n        this.requisitionService\r\n            .find(this.purchaseOrder.requisitionId)\r\n            .pipe(operators_1.map(function (res) { return (_this.requisition = res.body); }))\r\n            .pipe(operators_1.switchMap(function () {\r\n            return _this.quotationService.query({\r\n                'requisitionId.equals': _this.requisition.id,\r\n                'selectionStatus.equals': quotation_model_1.SelectionType.SELECTED\r\n            });\r\n        }))\r\n            .pipe(operators_1.map(function (res) {\r\n            _this.purchaseOrder.requisitionId = _this.requisition.id;\r\n            _this.quotation = res.body[0];\r\n            _this.purchaseOrder.quotationId = _this.quotation.id;\r\n            return _this.quotation;\r\n        }))\r\n            .pipe(operators_1.switchMap(function (res) {\r\n            return _this.quotationDetailsService.query({\r\n                'quotationId.equals': res.id\r\n            });\r\n        }))\r\n            .subscribe(function (res) {\r\n            _this.quotationDetails = res.body;\r\n        });\r\n    };\r\n    PurchaseOrderExtendedUpdateComponent.prototype.disableOrEnableComponents = function () {\r\n        var _this = this;\r\n        if ((this.purchaseOrder.status == purchase_order_model_1.PurchaseOrderStatus.MODIFICATION_REQUEST_BY_CFO ||\r\n            this.purchaseOrder.status == null ||\r\n            this.purchaseOrder.status == undefined) &&\r\n            this.currentAccount.authorities.includes('ROLE_REQUISITION')) {\r\n            setTimeout(function () {\r\n                _this.editForm.form.enable();\r\n            }, 500);\r\n        }\r\n        else {\r\n            setTimeout(function () {\r\n                _this.editForm.form.disable();\r\n            }, 500);\r\n        }\r\n    };\r\n    PurchaseOrderExtendedUpdateComponent.prototype.generatePurchaseOrderNo = function () {\r\n        var _this = this;\r\n        console.log('purchase order--->');\r\n        console.log(this.purchaseOrder);\r\n        if (!this.purchaseOrder.purchaseOrderNo) {\r\n            var dateStrFrom = new Date().getFullYear() + '-01-01';\r\n            var dateStrTo = new Date().getFullYear() + '-12-31';\r\n            this.purchaseOrderService\r\n                .query({\r\n                'issueDate.greaterOrEqualThan': dateStrFrom,\r\n                'issueDate.lessOrEqualThan': dateStrTo\r\n            })\r\n                .subscribe(function (res) {\r\n                var dateStr = moment(new Date()).format('DD-MM-YYYY');\r\n                _this.purchaseOrder.purchaseOrderNo =\r\n                    'PO-SOFPL-' + new Date().getFullYear() + '-' + _this.zeroPad(res.body.length + 1, 8);\r\n                _this.purchaseOrder.workOrderNo = 'WO-SOFPL-' + new Date().getFullYear() + '-' + _this.zeroPad(res.body.length + 1, 8);\r\n            });\r\n        }\r\n    };\r\n    PurchaseOrderExtendedUpdateComponent.prototype.zeroPad = function (num, places) {\r\n        var zero = places - num.toString().length + 1;\r\n        return Array(+(zero > 0 && zero)).join('0') + num;\r\n    };\r\n    PurchaseOrderExtendedUpdateComponent.prototype.save = function () {\r\n        this.isSaving = true;\r\n        if (this.purchaseOrder.id !== undefined) {\r\n            this.subscribeToSaveResponse(this.purchaseOrderService.update(this.purchaseOrder));\r\n        }\r\n        else {\r\n            this.subscribeToSaveResponse(this.purchaseOrderService.create(this.purchaseOrder));\r\n        }\r\n    };\r\n    PurchaseOrderExtendedUpdateComponent.prototype.saveAndSendForCFOApproval = function () {\r\n        this.purchaseOrder.status = purchase_order_model_1.PurchaseOrderStatus.WAITING_FOR_CFO_APPROVAL;\r\n        this.save();\r\n    };\r\n    PurchaseOrderExtendedUpdateComponent.prototype.saveAndSendForAccountsApproval = function () {\r\n        this.purchaseOrder.status = purchase_order_model_1.PurchaseOrderStatus.WAITING_FOR_ACCOUNTS_APPROVAL;\r\n        this.save();\r\n    };\r\n    PurchaseOrderExtendedUpdateComponent.prototype.modificationRequestByAccounts = function () {\r\n        this.purchaseOrder.status = purchase_order_model_1.PurchaseOrderStatus.MODIFICATION_REQUEST_BY_ACCOUNTS;\r\n        this.save();\r\n    };\r\n    PurchaseOrderExtendedUpdateComponent.prototype.approveByCfo = function () {\r\n        this.purchaseOrder.status = purchase_order_model_1.PurchaseOrderStatus.APPROVED_BY_CFO;\r\n        this.save();\r\n    };\r\n    PurchaseOrderExtendedUpdateComponent.prototype.rejectedByCfo = function () {\r\n        this.purchaseOrder.status = purchase_order_model_1.PurchaseOrderStatus.REJECTED_BY_CFO;\r\n        this.save();\r\n    };\r\n    PurchaseOrderExtendedUpdateComponent.prototype.requestForModificationByCfo = function () {\r\n        this.purchaseOrder.status = purchase_order_model_1.PurchaseOrderStatus.MODIFICATION_REQUEST_BY_CFO;\r\n        this.save();\r\n    };\r\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;\r\n    tslib_1.__decorate([\r\n        core_1.ViewChild('editForm'),\r\n        tslib_1.__metadata(\"design:type\", typeof (_a = typeof forms_1.NgForm !== \"undefined\" && forms_1.NgForm) === \"function\" ? _a : Object)\r\n    ], PurchaseOrderExtendedUpdateComponent.prototype, \"editForm\", void 0);\r\n    PurchaseOrderExtendedUpdateComponent = tslib_1.__decorate([\r\n        core_1.Component({\r\n            selector: 'jhi-purchase-order-update',\r\n            templateUrl: './purchase-order-extended-update.component.html'\r\n        }),\r\n        tslib_1.__metadata(\"design:paramtypes\", [typeof (_b = typeof ng_jhipster_1.JhiDataUtils !== \"undefined\" && ng_jhipster_1.JhiDataUtils) === \"function\" ? _b : Object, typeof (_c = typeof ng_jhipster_1.JhiAlertService !== \"undefined\" && ng_jhipster_1.JhiAlertService) === \"function\" ? _c : Object, typeof (_d = typeof purchase_order_extended_service_1.PurchaseOrderExtendedService !== \"undefined\" && purchase_order_extended_service_1.PurchaseOrderExtendedService) === \"function\" ? _d : Object, typeof (_e = typeof requisition_1.RequisitionService !== \"undefined\" && requisition_1.RequisitionService) === \"function\" ? _e : Object, typeof (_f = typeof quotation_1.QuotationService !== \"undefined\" && quotation_1.QuotationService) === \"function\" ? _f : Object, typeof (_g = typeof router_1.ActivatedRoute !== \"undefined\" && router_1.ActivatedRoute) === \"function\" ? _g : Object, typeof (_h = typeof employee_1.EmployeeService !== \"undefined\" && employee_1.EmployeeService) === \"function\" ? _h : Object, typeof (_j = typeof core_2.AccountService !== \"undefined\" && core_2.AccountService) === \"function\" ? _j : Object, typeof (_k = typeof quotation_details_1.QuotationDetailsService !== \"undefined\" && quotation_details_1.QuotationDetailsService) === \"function\" ? _k : Object])\r\n    ], PurchaseOrderExtendedUpdateComponent);\r\n    return PurchaseOrderExtendedUpdateComponent;\r\n}(purchase_order_1.PurchaseOrderUpdateComponent));\r\nexports.PurchaseOrderExtendedUpdateComponent = PurchaseOrderExtendedUpdateComponent;\r\n",{"version":3,"file":"C:\\Users\\hp\\Documents\\soptorshi-jhipster\\src\\main\\webapp\\app\\entities\\purchase-order-extended\\purchase-order-extended-update.component.ts","sourceRoot":"","sources":["C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\angular-router-loader\\src\\index.js!C:\\Users\\hp\\Documents\\soptorshi-jhipster\\node_modules\\tslint-loader\\index.js!C:\\Users\\hp\\Documents\\soptorshi-jhipster\\src\\main\\webapp\\app\\entities\\purchase-order-extended\\purchase-order-extended-update.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, ViewChild } from '@angular/core';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { HttpErrorResponse, HttpResponse } from '@angular/common/http';\r\nimport { filter, map, switchMap } from 'rxjs/operators';\r\nimport * as moment from 'moment';\r\nimport { JhiAlertService, JhiDataUtils } from 'ng-jhipster';\r\nimport { IPurchaseOrder, PurchaseOrderStatus } from 'app/shared/model/purchase-order.model';\r\nimport { IRequisition } from 'app/shared/model/requisition.model';\r\nimport { RequisitionService } from 'app/entities/requisition';\r\nimport { IQuotation, SelectionType } from 'app/shared/model/quotation.model';\r\nimport { QuotationService } from 'app/entities/quotation';\r\nimport { EmployeeService } from 'app/entities/employee';\r\nimport { AccountService } from 'app/core';\r\nimport { IEmployee } from 'app/shared/model/employee.model';\r\nimport { PurchaseOrderService, PurchaseOrderUpdateComponent } from 'app/entities/purchase-order';\r\nimport { NgForm } from '@angular/forms';\r\nimport { PurchaseOrderExtendedService } from 'app/entities/purchase-order-extended/purchase-order-extended.service';\r\nimport { IQuotationDetails } from 'app/shared/model/quotation-details.model';\r\nimport { QuotationDetailsService } from 'app/entities/quotation-details';\r\nimport { of } from 'rxjs';\r\n\r\n@Component({\r\n    selector: 'jhi-purchase-order-update',\r\n    templateUrl: './purchase-order-extended-update.component.html'\r\n})\r\nexport class PurchaseOrderExtendedUpdateComponent extends PurchaseOrderUpdateComponent implements OnInit {\r\n    currentAccount: any;\r\n    currentEmployee: IEmployee;\r\n    form: any;\r\n    requisition: IRequisition;\r\n    quotation: IQuotation;\r\n    quotationDetails: IQuotationDetails[];\r\n\r\n    @ViewChild('editForm') editForm: NgForm;\r\n\r\n    constructor(\r\n        protected dataUtils: JhiDataUtils,\r\n        protected jhiAlertService: JhiAlertService,\r\n        protected purchaseOrderService: PurchaseOrderExtendedService,\r\n        protected requisitionService: RequisitionService,\r\n        protected quotationService: QuotationService,\r\n        protected activatedRoute: ActivatedRoute,\r\n        protected employeeService: EmployeeService,\r\n        public accountService: AccountService,\r\n        private quotationDetailsService: QuotationDetailsService\r\n    ) {\r\n        super(dataUtils, jhiAlertService, purchaseOrderService, requisitionService, quotationService, activatedRoute);\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.accountService.identity().then(account => {\r\n            this.currentAccount = account;\r\n            console.log('Current account --->');\r\n            console.log(this.currentAccount);\r\n            this.employeeService\r\n                .query({\r\n                    'employeeId.equals': this.currentAccount.login\r\n                })\r\n                .subscribe(\r\n                    (res: HttpResponse<IEmployee[]>) => {\r\n                        this.currentEmployee = res.body[0];\r\n                    },\r\n                    (res: HttpErrorResponse) => this.onError(res.message)\r\n                );\r\n\r\n            this.activatedRoute.data.subscribe(({ purchaseOrder }) => {\r\n                of(purchaseOrder)\r\n                    .pipe(\r\n                        switchMap(res => {\r\n                            this.purchaseOrder = purchaseOrder;\r\n                            return of(this.purchaseOrder);\r\n                        })\r\n                    )\r\n                    .pipe(\r\n                        filter(res => {\r\n                            if (res.requisitionId) return true;\r\n                            else return false;\r\n                        })\r\n                    )\r\n                    .subscribe(() => this.fetchRequisitionAndQuotationWithDetails());\r\n\r\n                this.disableOrEnableComponents();\r\n                this.generatePurchaseOrderNo();\r\n            });\r\n        });\r\n\r\n        this.isSaving = false;\r\n\r\n        this.requisitionService\r\n            .query()\r\n            .pipe(\r\n                filter((mayBeOk: HttpResponse<IRequisition[]>) => mayBeOk.ok),\r\n                map((response: HttpResponse<IRequisition[]>) => response.body)\r\n            )\r\n            .subscribe((res: IRequisition[]) => (this.requisitions = res), (res: HttpErrorResponse) => this.onError(res.message));\r\n        this.quotationService\r\n            .query()\r\n            .pipe(\r\n                filter((mayBeOk: HttpResponse<IQuotation[]>) => mayBeOk.ok),\r\n                map((response: HttpResponse<IQuotation[]>) => response.body)\r\n            )\r\n            .subscribe((res: IQuotation[]) => (this.quotations = res), (res: HttpErrorResponse) => this.onError(res.message));\r\n    }\r\n\r\n    downloadReport() {\r\n        this.purchaseOrderService.downloadPurchaseOrderReport(this.purchaseOrder.id);\r\n    }\r\n\r\n    fetchRequisitionAndQuotationWithDetails(): void {\r\n        this.requisitionService\r\n            .find(this.purchaseOrder.requisitionId)\r\n            .pipe(map(res => (this.requisition = res.body)))\r\n            .pipe(\r\n                switchMap(() =>\r\n                    this.quotationService.query({\r\n                        'requisitionId.equals': this.requisition.id,\r\n                        'selectionStatus.equals': SelectionType.SELECTED\r\n                    })\r\n                )\r\n            )\r\n            .pipe(\r\n                map(res => {\r\n                    this.purchaseOrder.requisitionId = this.requisition.id;\r\n                    this.quotation = res.body[0];\r\n                    this.purchaseOrder.quotationId = this.quotation.id;\r\n                    return this.quotation;\r\n                })\r\n            )\r\n            .pipe(\r\n                switchMap(res => {\r\n                    return this.quotationDetailsService.query({\r\n                        'quotationId.equals': res.id\r\n                    });\r\n                })\r\n            )\r\n            .subscribe(res => {\r\n                this.quotationDetails = res.body;\r\n            });\r\n    }\r\n\r\n    disableOrEnableComponents() {\r\n        if (\r\n            (this.purchaseOrder.status == PurchaseOrderStatus.MODIFICATION_REQUEST_BY_CFO ||\r\n                this.purchaseOrder.status == null ||\r\n                this.purchaseOrder.status == undefined) &&\r\n            this.currentAccount.authorities.includes('ROLE_REQUISITION')\r\n        ) {\r\n            setTimeout(() => {\r\n                this.editForm.form.enable();\r\n            }, 500);\r\n        } else {\r\n            setTimeout(() => {\r\n                this.editForm.form.disable();\r\n            }, 500);\r\n        }\r\n    }\r\n\r\n    generatePurchaseOrderNo() {\r\n        console.log('purchase order--->');\r\n        console.log(this.purchaseOrder);\r\n        if (!this.purchaseOrder.purchaseOrderNo) {\r\n            const dateStrFrom = new Date().getFullYear() + '-01-01';\r\n            const dateStrTo = new Date().getFullYear() + '-12-31';\r\n            this.purchaseOrderService\r\n                .query({\r\n                    'issueDate.greaterOrEqualThan': dateStrFrom,\r\n                    'issueDate.lessOrEqualThan': dateStrTo\r\n                })\r\n                .subscribe((res: HttpResponse<IPurchaseOrder[]>) => {\r\n                    const dateStr = moment(new Date()).format('DD-MM-YYYY');\r\n                    this.purchaseOrder.purchaseOrderNo =\r\n                        'PO-SOFPL-' + new Date().getFullYear() + '-' + this.zeroPad(res.body.length + 1, 8);\r\n                    this.purchaseOrder.workOrderNo = 'WO-SOFPL-' + new Date().getFullYear() + '-' + this.zeroPad(res.body.length + 1, 8);\r\n                });\r\n        }\r\n    }\r\n\r\n    zeroPad(num, places): string {\r\n        const zero = places - num.toString().length + 1;\r\n        return Array(+(zero > 0 && zero)).join('0') + num;\r\n    }\r\n\r\n    save() {\r\n        this.isSaving = true;\r\n        if (this.purchaseOrder.id !== undefined) {\r\n            this.subscribeToSaveResponse(this.purchaseOrderService.update(this.purchaseOrder));\r\n        } else {\r\n            this.subscribeToSaveResponse(this.purchaseOrderService.create(this.purchaseOrder));\r\n        }\r\n    }\r\n\r\n    saveAndSendForCFOApproval() {\r\n        this.purchaseOrder.status = PurchaseOrderStatus.WAITING_FOR_CFO_APPROVAL;\r\n        this.save();\r\n    }\r\n\r\n    saveAndSendForAccountsApproval() {\r\n        this.purchaseOrder.status = PurchaseOrderStatus.WAITING_FOR_ACCOUNTS_APPROVAL;\r\n        this.save();\r\n    }\r\n\r\n    modificationRequestByAccounts() {\r\n        this.purchaseOrder.status = PurchaseOrderStatus.MODIFICATION_REQUEST_BY_ACCOUNTS;\r\n        this.save();\r\n    }\r\n\r\n    approveByCfo() {\r\n        this.purchaseOrder.status = PurchaseOrderStatus.APPROVED_BY_CFO;\r\n        this.save();\r\n    }\r\n\r\n    rejectedByCfo() {\r\n        this.purchaseOrder.status = PurchaseOrderStatus.REJECTED_BY_CFO;\r\n        this.save();\r\n    }\r\n\r\n    requestForModificationByCfo() {\r\n        this.purchaseOrder.status = PurchaseOrderStatus.MODIFICATION_REQUEST_BY_CFO;\r\n        this.save();\r\n    }\r\n}\r\n"]}]}